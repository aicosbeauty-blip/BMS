<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script type="module" src="/@vite/client"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·è¯„ä¼°æŠ¥å‘Šæ¨¡æ¿ (v3.4 - å¤–éƒ¨æ•°æ®)</title>
    <!-- æ ·å¼ä¸åŸæ–‡ä»¶ç›¸åŒ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "SimSun", sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }
        
        .page {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto 20px;
            padding: 20mm;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            page-break-after: always;
        }
        
        @media print {
            .page {
                margin: 0;
                box-shadow: none;
                page-break-after: always;
            }
            .image-gallery, .modal {
                display: none; /* æ‰“å°æ—¶éšè—å½±åƒå»Šå’Œå¼¹çª— */
            }
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 40px;
            margin: -20mm -20mm 20px -20mm;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .logo-subtitle {
            font-size: 14px;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .title-main {
            font-size: 36px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .subtitle {
            font-size: 18px;
            margin-bottom: 30px;
        }
        
        .qr-code {
            width: 120px;
            height: 120px;
            background: white;
            margin: 20px auto;
            padding: 10px;
            border-radius: 10px;
        }
        
        .qr-placeholder {
            width: 100%;
            height: 100%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }
        
        .info-section {
            margin: 20px 0;
        }
        
        .info-row {
            display: flex;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .info-label {
            width: 120px;
            font-weight: bold;
        }
        
        .info-value {
            flex: 1;
        }
        
        .section-title {
            background: #1e3a8a;
            color: white;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            margin: 30px 0 20px 0;
            text-align: center;
        }
        
        .subsection-title {
            background: #f3f4f6;
            padding: 10px 15px;
            font-weight: bold;
            margin: 20px 0 10px 0;
            border-left: 4px solid #1e3a8a;
        }
        
        .content-box {
            background: #f9fafb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .recommendation-box {
            background: #e8f5e9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
        }
        
        .ai-judge-box, .doctor-judge-box {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 13px;
        }
        .ai-judge-box {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }
        .doctor-judge-box {
            background: #e0f2fe;
            border-left: 4px solid #0ea5e9;
        }
        .judge-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }
        
        table th {
            background: #1e3a8a;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
        }
        
        table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        table tr:nth-child(even) {
            background: #f9fafb;
        }
        
        .highlight {
            color: #dc2626;
            font-weight: bold;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            font-size: 12px;
            color: #666;
        }
        
        .page-number {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 20px;
        }
        
        ul, ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .body-diagram {
            text-align: center;
            margin: 30px 0;
        }
        
        .body-diagram-placeholder {
            width: 200px;
            height: 400px;
            margin: 0 auto;
            background: #f3f4f6;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .template-comment {
            background: #fffbef;
            border: 1px dashed #fcd34d;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            color: #b45309;
            border-radius: 5px;
            display: none; 
        }
        
        body.dev-mode .template-comment {
            display: block;
        }

        /* ----- æ–°å¢å½±åƒæ ·å¼ ----- */
        .image-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 15px;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 5px;
            margin-top: 10px;
            page-break-inside: avoid;
        }
        .gallery-item {
            width: 150px;
            text-align: center;
        }
        .gallery-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .gallery-image:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .gallery-caption {
            font-size: 11px;
            color: #555;
            margin-top: 5px;
            line-height: 1.3;
            word-wrap: break-word;
        }
        
        /* ----- æ–°å¢å¼¹çª— (Modal) æ ·å¼ ----- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1001; 
            padding-top: 60px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.9); 
        }
        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 80vh;
            border-radius: 5px;
        }
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 15px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        .modal-content, #caption {
            animation-name: zoom;
            animation-duration: 0.4s;
        }
        @keyframes zoom {
            from {transform: scale(0.8)}
            to {transform: scale(1)}
        }
        .close-btn {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 1002;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: #bbb;
            text-decoration: none;
        }
        /* ----- æ ·å¼ç»“æŸ ----- */
    </style>
</head>
<body>

    <!-- ç¬¬1é¡µ - å°é¢ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="header">
            <div class="logo">INCOSC</div>
            <div class="logo-subtitle">å›½é™…å¹²ç»†èƒè”åˆç ”ç©¶ä¸­å¿ƒ<br>International Consortium of Stem Cell Research</div>
            <div class="title-main">ä¼šå‘˜å¥åº·<br>æ¡£æ¡ˆ</div>
            <div class="subtitle">æ…¢ç—…åº·å…»ï¼Œè‚¿ç˜¤é¢„é˜²ï¼Œç»¼åˆæŠ—è¡°</div>
        </div>
        <div class="qr-code">
            <div class="qr-placeholder">æ‰«ç å…³æ³¨<br>INCOSCå…¬ä¼—å·</div>
        </div>
        <div class="info-section">
            <div class="info-row">
                <div class="info-label">å§“åï¼š</div>
                <div class="info-value" data-json-path="patientInfo.name"></div>
            </div>
            <div class="info-row">
                <div class="info-label">æ€§åˆ«ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.gender"></div>
            </div>
            <div class="info-row">
                <div class="info-label">å¹´é¾„ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.age"></div>
            </div>
            <div class="info-row">
                <div class="info-label">èº«é«˜ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.height"></div>
            </div>
            <div class="info-row">
                <div class="info-label">ä½“é‡ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.weight"></div>
            </div>
            <div class="info-row">
                <div class="info-label">BMIï¼š</div>
                <div class="info-value" data-json-path="patientInfo.bmi"></div>
            </div>
            <div class="info-row">
                <div class="info-label">æ”¶ç¼©å‹ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.bloodPressure_Systolic"></div>
            </div>
            <div class="info-row">
                <div class="info-label">èˆ’å¼ å‹ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.bloodPressure_Diastolic"></div>
            </div>
            <div class="info-row">
                <div class="info-label">è¿‡æ•ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.allergy"></div>
            </div>
            <div class="info-row">
                <div class="info-label">è¯‰æ±‚ï¼š</div>
                <div class="info-value" data-json-path="patientInfo.mainConcern"></div>
            </div>
            <div class="info-row">
                <div class="info-label">ä½“æ£€å•ä½</div>
                <div class="info-value" data-json-path="patientInfo.examUnit"></div>
            </div>
            <div class="info-row">
                <div class="info-label">æ£€æŸ¥æ—¥æœŸ</div>
                <div class="info-value" data-json-path="patientInfo.examDate"></div>
            </div>
            <div class="info-row">
                <div class="info-label">å»ºæ¡£æ—¥æœŸï¼š</div>
                <div class="info-value" data-json-path="patientInfo.reportDate"></div>
            </div>
        </div>
        <div class="footer">
            æ·±è€•ç»†èƒç§‘æŠ€<br>å®ˆæŠ¤å›½æ°‘å¥åº·
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 1</div>
    </div>

    <!-- ç¬¬2é¡µ - ç—…å² ä¸ ä¸“ç§‘æ£€æŸ¥ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">ä½“æ£€ç»“æœ</div>
        <div class="subsection-title">ç—…å²æƒ…å†µ</div>
        <div class="content-box">
            <p><strong>ç—…å²ï¼š</strong><span data-json-path="medicalHistory.history"></span></p>
            <p><strong>æœè¯æƒ…å†µï¼š</strong><span data-json-path="medicalHistory.medication"></span></p>
            <p><strong>è¥å…»å“ä¸ä¿å¥å“ï¼š</strong><span data-json-path="medicalHistory.supplements"></span></p>
            <p><strong>ç”Ÿæ´»æ–¹å¼ï¼š</strong><span data-json-path="medicalHistory.lifestyle"></span></p>
        </div>
        <div class="recommendation-box">
            <p><strong>è¯„ä¼°ä¸å»ºè®®ï¼š</strong></p>
            <p data-json-path="medicalHistory.assessment"></p>
        </div>
        <div class="template-comment">
            <p><strong>æ¨¡æ¿è¯´æ˜ï¼š</strong>ä¸‹æ–¹å†…å®¹å°†æ ¹æ® `specialistExams` æ•°ç»„åŠ¨æ€ç”Ÿæˆã€‚å°†ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡é‡å¤ `specialist-exam-item` æ¨¡æ¿å—ã€‚</p>
        </div>
        <div id="specialist-exams-container" data-json-array="specialistExams">
            <!-- specialistExams å¾ªç¯æ¨¡æ¿ - å°†ç”± JavaScript å¡«å…… -->
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 2</div>
    </div>

    <!-- ç¬¬3é¡µ - å®éªŒå®¤æ£€æŸ¥ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">å®éªŒå®¤æ£€æŸ¥ç»“æœ</div>
        <div class="template-comment">
            <p><strong>æ¨¡æ¿è¯´æ˜ï¼š</strong>ä¸‹æ–¹å†…å®¹å°†æ ¹æ® `labResults` æ•°ç»„åŠ¨æ€ç”Ÿæˆã€‚</p>
        </div>
        <div id="lab-results-container" data-json-array="labResults">
            <!-- labResults å¾ªç¯æ¨¡æ¿ - å°†ç”± JavaScript å¡«å…… -->
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 3</div>
    </div>

    <!-- ç¬¬4é¡µ - å½±åƒæ£€æŸ¥ (*** æ­¤é¡µå·²ä¿®æ”¹ ***) -->
    <div class="page">
        <div class="section-title">å½±åƒæ£€æŸ¥</div>

        <div class="template-comment">
            <p><strong>æ¨¡æ¿è¯´æ˜ï¼š</strong>ä¸‹æ–¹å†…å®¹å°†æ ¹æ® `imagingResults` æ•°ç»„åŠ¨æ€ç”Ÿæˆã€‚å°†ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡é‡å¤ `imaging-result-item` æ¨¡æ¿å—ã€‚</p>
            <p><strong>V3.3 æ–°å¢ï¼š</strong>æ¯ä¸ªå½±åƒæ£€æŸ¥é¡¹ç°åœ¨åŒ…å« `AIJudge` å’Œ `DoctorJudge` å­—æ®µã€‚</p>
            <p><strong>*** V3.4 (è‡ªå®šä¹‰) æ–°å¢ï¼š***</strong> 
                å¦‚æœ `image_data.json` ä¸­å­˜åœ¨åŒ¹é…çš„å½±åƒç±»åˆ«ï¼Œå°†è‡ªåŠ¨åœ¨æ­¤å¤„æ’å…¥ä¸€ä¸ªå½±åƒå»Š (`.image-gallery`)ã€‚
                å›¾ç‰‡è·¯å¾„å‡å®šä¸º `Images/` ç›®å½•ã€‚
            </p>
        </div>

        <!-- imagingResults å¾ªç¯æ¨¡æ¿ - å°†ç”± JavaScript å¡«å…… (*** æ­¤å¤„é€»è¾‘å·²æ›´æ–° ***) -->
        <div id="imaging-results-container" data-json-array="imagingResults">
        </div>
        
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 4</div>
    </div>

    <!-- ç¬¬5é¡µ - å¥åº·ä¸“å®¶æ„è§å°é¢ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div style="text-align: center; margin-top: 100px;">
            <div class="logo" style="color: #1e3a8a; margin-bottom: 50px;">INCOSC</div>
            <div class="logo-subtitle" style="color: #666;">å›½é™…å¹²ç»†èƒè”åˆç ”ç©¶ä¸­å¿ƒ<br>International Consortium of Stem Cell Research</div>
            <h1 style="font-size: 36px; margin: 80px 0; color: #1e3a8a;">å¥åº·ä¸“å®¶æ„è§</h1>
            <div class="body-diagram">
                <div class="body-diagram-placeholder">äººä½“ç¤ºæ„å›¾</div>
            </div>
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 5</div>
    </div>

    <!-- ç¬¬6é¡µ - å¥åº·ä¸“å®¶æ„è§è¯¦æƒ… -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">å¥åº·ç³»ç»Ÿ</div>
        <div class="template-comment">
            <p><strong>æ¨¡æ¿è¯´æ˜ï¼š</strong>ä¸‹æ–¹å†…å®¹å°†æ ¹æ® `expertOpinions` æ•°ç»„åŠ¨æ€ç”Ÿæˆã€‚</p>
        </div>
        <div id="expert-opinions-container" data-json-array="expertOpinions">
            <!-- expertOpinions å¾ªç¯æ¨¡æ¿ - å°†ç”± JavaScript å¡«å…… -->
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 6</div>
    </div>

    <!-- ç¬¬7é¡µ - åº·å…»å®‰å…¨æ„è§å°é¢ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div style="text-align: center; margin-top: 100px;">
            <div class="logo" style="color: #1e3a8a; margin-bottom: 50px;">INCOSC</div>
            <div class="logo-subtitle" style="color: #666;">å›½é™…å¹²ç»†èƒè”åˆç ”ç©¶ä¸­å¿ƒ<br>International Consortium of Stem Cell Research</div>
            <h1 style="font-size: 36px; margin: 80px 0; color: #1e3a8a;">åº·å…»å®‰å…¨æ„è§</h1>
            <div class="body-diagram">
                <div class="body-diagram-placeholder">äººä½“ç¤ºæ„å›¾</div>
            </div>
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 7</div>
    </div>

    <!-- ç¬¬8é¡µ - åº·å…»å®‰å…¨è¯„ä¼° -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">åº·å…»å®‰å…¨è¯„ä¼°</div>
        <div class="subsection-title">ä¸€ã€é€‚ç”¨æ€§è¯„ä¼°</div>
        <div id="applicability-assessment-container" data-json-array="wellnessSafetyAssessment.applicabilityAssessment"></div>
        <div class="subsection-title">äºŒã€å®‰å…¨æ€§è¯„ä¼°</div>
        <div>
            <div class="content-box">
                <p><strong>ï¼ˆ1ï¼‰ä¸å®œå®‰æ’ç»†èƒåº”ç”¨çš„æƒ…å†µï¼š</strong></p>
                <div id="contraindications-container" data-json-array="wellnessSafetyAssessment.safetyAssessment.contraindications"></div>
            </div>
            <div class="content-box">
                <p><strong>ï¼ˆ2ï¼‰è¯„ä¼°ç»“æœï¼š</strong><span data-json-path="wellnessSafetyAssessment.safetyAssessment.assessmentResult"></span></p>
            </div>
            <div class="content-box">
                <p><strong>ï¼ˆ3ï¼‰ç‰¹åˆ«æç¤ºï¼š</strong><span data-json-path="wellnessSafetyAssessment.safetyAssessment.specialNote"></span></p>
            </div>
        </div>
        <div class="subsection-title">ä¸‰ã€è¡¥å……æ£€æŸ¥ï¼ˆåº”ç”¨ç»†èƒå‰ï¼‰</div>
        <div class="content-box">
            <p><strong>ï¼ˆ1ï¼‰æŠ½è¡€é¡¹ç›®ï¼š</strong></p>
            <div id="blood-draw-items-container" data-json-array="wellnessSafetyAssessment.supplementaryExams.bloodDrawItems"></div>
            <p style="margin-top: 10px;"><strong>ï¼ˆ2ï¼‰å½±åƒå­¦æ£€æŸ¥ï¼š</strong></p>
            <div id="imaging-exams-container" data-json-array="wellnessSafetyAssessment.supplementaryExams.imagingExams"></div>
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 8</div>
    </div>

    <!-- ç¬¬9é¡µ - åº·å…»è®¡åˆ’(1) -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">åº·å…»è®¡åˆ’ï¼ˆ1ï¼‰</div>
        <div class="subsection-title">ä¸€ã€ä¸»è¦å¥åº·é—®é¢˜</div>
        <div id="main-issues-container" data-json-array="healthPlan.mainIssues"></div>
        <div class="subsection-title">äºŒã€æ¬¡è¦å¥åº·é—®é¢˜</div>
        <div id="secondary-issues-container" data-json-array="healthPlan.secondaryIssues"></div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 9</div>
    </div>


    <!-- ç¬¬10é¡µ - åº·å…»è®¡åˆ’(2) -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div class="section-title">åº·å…»è®¡åˆ’ï¼ˆ2ï¼‰</div>
        <div class="subsection-title">ä¸€ã€åº·å…»è®¡åˆ’</div>
        <table>
            <thead>
                <tr>
                    <th colspan="4" style="text-align: center; font-size: 16px;">åº·å…»ä¿å¥æ–¹æ¡ˆ</th>
                </tr>
                <tr>
                    <th></th>
                    <th>ç»†èƒç±»å‹</th>
                    <th>åº”ç”¨æ–¹æ¡ˆ</th>
                    <th>é¢„æœŸæ•ˆæœ</th>
                </tr>
            </thead>
            <tbody id="plan-details-tbody" data-json-array="healthPlan.planDetails"></tbody>
        </table>
        <div class="subsection-title">äºŒã€é¢„é˜²è®¡åˆ’</div>
        <div class="content-box" id="preventive-plan-container" data-json-array="healthPlan.preventivePlan"></div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 10</div>
    </div>

    <!-- ç¬¬11é¡µ - ç»“æŸé¡µ -->
    <div class="page">
        <!-- é¡µé¢å†…å®¹... (ä¸åŸæ–‡ä»¶ç›¸åŒ) -->
        <div style="text-align: center; margin-top: 150px;">
            <div class="logo" style="color: #1e3a8a; margin-bottom: 30px; font-size: 60px;">INCOSC</div>
            <div class="logo-subtitle" style="color: #666; font-size: 16px; margin-bottom: 50px;">å›½é™…å¹²ç»†èƒè”åˆç ”ç©¶ä¸­å¿ƒ<br>International Consortium of Stem Cell Research</div>
            <div class="qr-code" style="margin: 50px auto;">
                <div class="qr-placeholder">äºŒç»´ç <br>æ‰«ç å…³æ³¨</div>
            </div>
            <p style="font-size: 18px; color: #1e3a8a; margin: 20px 0;">æ‰«ç å…³æ³¨</p>
            <p style="font-size: 20px; font-weight: bold; color: #1e3a8a; margin: 20px 0;">INCOSC å…¬ä¼—å·</p>
            <div style="margin-top: 80px; padding: 30px; background: #f3f4f6; border-radius: 10px;">
                <p style="font-size: 14px; color: #666; line-height: 2;">å¦‚æœæ‚¨åœ¨é˜…è¯»æœ¬æŠ¥å‘Šæ—¶æœ‰é—®é¢˜ï¼Œè¯·åŠæ—¶å‘æ‚¨çš„å¥åº·ç®¡ç†ä¸“å®¶æˆ–<br>åŒ»ç”Ÿè¿›è¡Œå’¨è¯¢ã€‚</p>
            </div>
            <div style="margin-top: 50px; font-size: 16px; color: #1e3a8a;">
                <p>æ…¢ç—…åº·å…»ï¼Œè‚¿ç˜¤é¢„é˜²ï¼Œç»¼åˆæŠ—è¡°</p>
            </div>
        </div>
        <div class="page-number">å¥åº·è¯„ä¼°æŠ¥å‘Š|å®¢æˆ·éšç§æ–‡ä»¶ 11</div>
    </div>

    <!-- ***** æ–°å¢ Modal Lightbox HTML ***** -->
    <div id="imageModal" class="modal">
        <span class="close-btn">&times;</span>
        <img class="modal-content" id="modalImage">
        <div id="caption"></div>
    </div>
    <!-- ***** Modal ç»“æŸ ***** -->


    <script>
      // (*** æ­¤å¤„é€»è¾‘å·²ä¿®æ”¹ ***)
      
      /**
       * ä»å¯¹è±¡è·¯å¾„è·å–å€¼
       * @param {object} obj - æ•°æ®å¯¹è±¡
       * @param {string} path - è·¯å¾„ï¼Œå¦‚ "patientInfo.name"
       * @returns {*} å€¼
       */
      function getValueByPath(obj, path) {
        if (!path) return null;
        const keys = path.split('.');
        let value = obj;
        for (const key of keys) {
          if (value && typeof value === 'object' && key in value) {
            value = value[key];
          } else {
            return null;
          }
        }
        return value;
      }
      
      /**
       * å®‰å…¨çš„ HTML è½¬ä¹‰
       */
      function escapeHtml(text) {
        if (text === null || text === undefined) return '';
        const div = document.createElement('div');
        div.textContent = String(text);
        return div.innerHTML;
      }
      
      /**
       * å¡«å……ç®€å•æ•°æ®è·¯å¾„ (data-json-path)
       */
      function fillSimplePaths(data) {
        document.querySelectorAll('[data-json-path]').forEach(el => {
          const path = el.getAttribute('data-json-path');
          if (!path) return;
          
          const value = getValueByPath(data, path);
          if (value !== null && value !== undefined) {
            const suffix = el.getAttribute('data-suffix') || '';
            const displayValue = String(value) + suffix;
            
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
              el.value = displayValue;
            } else {
              el.textContent = displayValue;
            }
          }
        });
      }
      
      /**
       * æ¸²æŸ“ä¸“ç§‘æ£€æŸ¥ (specialistExams)
       */
      function renderSpecialistExams(exams) {
        const container = document.getElementById('specialist-exams-container');
        if (!container || !exams || !Array.isArray(exams) || exams.length === 0) return;
        
        container.innerHTML = exams.map(exam => `
          <div class="specialist-exam-item" style="margin-bottom: 20px; border-bottom: 1px dashed #ccc; padding-bottom: 10px; page-break-inside: avoid;">
            <div class="subsection-title">${escapeHtml(exam.category)}</div>
            <div class="content-box">
              <p>${escapeHtml(exam.finding)}</p>
            </div>
            <div class="recommendation-box">
              <p><strong>è¯„ä¼°ä¸å»ºè®®ï¼š</strong></p>
              <p>${escapeHtml(exam.assessment)}</p>
            </div>
            ${exam.AIJudge ? `
              <div class="ai-judge-box">
                <p class="judge-title">AI è¯„ä¼° (${escapeHtml(exam.AIJudge.result || '')})</p>
                <p>${escapeHtml(exam.AIJudge.assessment)}</p>
              </div>
            ` : ''}
            ${exam.DoctorJudge ? `
              <div class="doctor-judge-box">
                <p class="judge-title">åŒ»ç”Ÿå»ºè®® (${escapeHtml(exam.DoctorJudge.result || '')})</p>
                <p>${escapeHtml(exam.DoctorJudge.assessment)}</p>
              </div>
            ` : ''}
          </div>
        `).join('');
      }
      
      /**
       * æ¸²æŸ“å®éªŒå®¤æ£€æŸ¥ (labResults)
       */
      function renderLabResults(labs) {
        const container = document.getElementById('lab-results-container');
        if (!container || !labs || !Array.isArray(labs) || labs.length === 0) return;
        
        container.innerHTML = labs.map(lab => `
          <div class="lab-result-category" style="page-break-inside: avoid;">
            <div class="subsection-title">${escapeHtml(lab.category)}</div>
            
            ${lab.items && lab.items.length > 0 ? `
              <table>
                <thead>
                  <tr>
                    <th>é¡¹ç›®åç§°</th>
                    <th>ç»“æœ</th>
                    <th>å•ä½</th>
                    <th>å‚è€ƒå€¼</th>
                  </tr>
                </thead>
                <tbody>
                  ${lab.items.map(item => `
                    <tr>
                      <td>${escapeHtml(item.name)}</td>
                      <td class="${item.isAbnormal ? 'highlight' : ''}">${escapeHtml(item.value)}</td>
                      <td>${escapeHtml(item.unit)}</td>
                      <td>${escapeHtml(item.referenceRange)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            ` : ''}
            
            <div class="recommendation-box">
              <p><strong>è¯„ä¼°ä¸å»ºè®®ï¼š</strong></p>
              <p>${escapeHtml(lab.assessment)}</p>
            </div>
            
            ${lab.AIJudge ? `
              <div class="ai-judge-box">
                <p class="judge-title">AI è¯„ä¼° (${escapeHtml(lab.AIJudge.result || '')})</p>
                <p>${escapeHtml(lab.AIJudge.assessment)}</p>
              </div>
            ` : ''}
            ${lab.DoctorJudge ? `
              <div class="doctor-judge-box">
                <p class="judge-title">åŒ»ç”Ÿå»ºè®® (${escapeHtml(lab.DoctorJudge.result || '')})</p>
                <p>${escapeHtml(lab.DoctorJudge.assessment)}</p>
              </div>
            ` : ''}
          </div>
        `).join('');
      }
      
      /**
       * æ¸²æŸ“å½±åƒæ£€æŸ¥ (imagingResults)
       * (*** æ­¤å‡½æ•°å·²æ›´æ–° ***)
       * @param {Array} imaging - reportData.imagingResults
       * @param {Object} imageCategories - imageData.category
       */
      function renderImagingResults(imaging, imageCategories) {
        const container = document.getElementById('imaging-results-container');
        if (!container || !imaging || !Array.isArray(imaging) || imaging.length === 0) return;
        
        if (!imageCategories) {
            console.warn("å½±åƒæ•°æ®(imageCategories)æœªæä¾›ï¼Œå°†ä¸æ˜¾ç¤ºå›¾ç‰‡å»Šã€‚");
            imageCategories = {};
        }

        container.innerHTML = imaging.map(img => {
          
          // --- æ–°å¢ï¼šç”Ÿæˆå½±åƒå»Š ---
          const categoryKey = img.category;
          const images = imageCategories[categoryKey] || [];
          let galleryHtml = '';

          if (images.length > 0) {
            galleryHtml = `
              <div class="image-gallery">
                ${images.map(image => `
                  <div class="gallery-item">
                    <img src="Images/${escapeHtml(image.filename)}" 
                         alt="${escapeHtml(image.filedesc)}" 
                         class="gallery-image"
                         data-description="${escapeHtml(image.description)}"
                         onerror="this.src='https://placehold.co/150x150/eee/999?text=Image+Not+Found'">
                    <div class="gallery-caption">${escapeHtml(image.filedesc)}</div>
                  </div>
                `).join('')}
              </div>
            `;
          }
          // --- å½±åƒå»Šç»“æŸ ---

          return `
            <div class="imaging-result-item" style="page-break-inside: avoid; margin-bottom: 20px;">
              <div class="subsection-title">${escapeHtml(img.category)}</div>
              <div class="content-box">
                ${img.findings && img.findings.length > 0 
                  ? img.findings.map(f => `<p>${escapeHtml(f)}</p>`).join('') 
                  : '<p>æ— å¼‚å¸¸å‘ç°</p>'}
              </div>
              
              <!-- åœ¨æ­¤å¤„æ’å…¥å½±åƒå»Š -->
              ${galleryHtml}

              <div class="recommendation-box">
                <p><strong>è¯„ä¼°ä¸å»ºè®®ï¼š</strong></p>
                <p>${escapeHtml(img.assessment)}</p>
              </div>
              ${img.AIJudge ? `
                <div class="ai-judge-box">
                  <p class="judge-title">AI è¯„ä¼° (${escapeHtml(img.AIJudge.result || '')})</p>
                  <p>${escapeHtml(img.AIJudge.assessment)}</p>
                </div>
              ` : ''}
              ${img.DoctorJudge ? `
                <div class="doctor-judge-box">
                  <p class="judge-title">åŒ»ç”Ÿå»ºè®® (${escapeHtml(img.DoctorJudge.result || '')})</p>
                  <p>${escapeHtml(img.DoctorJudge.assessment)}</p>
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      }
      
      /**
       * æ¸²æŸ“å¥åº·ä¸“å®¶æ„è§ (expertOpinions)
       */
      function renderExpertOpinions(opinions) {
        const container = document.getElementById('expert-opinions-container');
        if (!container || !opinions || !Array.isArray(opinions) || opinions.length === 0) return;
        
        container.innerHTML = opinions.map(op => `
          <div class="expert-opinion-item" style="page-break-inside: avoid; margin-bottom: 20px;">
            <div class="subsection-title">${escapeHtml(op.system)}</div>
            <div class="content-box">
              <p><strong>ä½“æ£€é˜³æ€§å‘ç°ï¼š</strong></p>
              ${op.positiveFindings && op.positiveFindings.length > 0 
                ? op.positiveFindings.map(f => `<p>${escapeHtml(f)}</p>`).join('') 
                : '<p>æ— </p>'}
            </div>
            ${op.AIJudge ? `
              <div class="ai-judge-box">
                <p class="judge-title">AI è¯„ä¼° (${escapeHtml(op.AIJudge.result || '')})</p>
                <p>${escapeHtml(op.AIJudge.assessment)}</p>
              </div>
            ` : ''}
            ${op.DoctorJudge ? `
              <div class="doctor-judge-box">
                <p class="judge-title">åŒ»ç”Ÿå»ºè®® (${escapeHtml(op.DoctorJudge.result || '')})</p>
                <p>${escapeHtml(op.DoctorJudge.assessment)}</p>
              </div>
            ` : ''}
            <div class="recommendation-box">
              <p><strong>åŒ»ç–—ç»„è¯„ä¼°åŠå»ºè®®ï¼š</strong></p>
              ${op.assessmentAndRecommendations && op.assessmentAndRecommendations.length > 0 
                ? op.assessmentAndRecommendations.map(r => `<p>${escapeHtml(r)}</p>`).join('') 
                : '<p>æ— </p>'}
            </div>
          </div>
        `).join('');
      }
      
      /**
       * æ¸²æŸ“åº·å…»å®‰å…¨è¯„ä¼° (wellnessSafetyAssessment)
       */
      function renderWellnessSafety(wellness) {
        if (!wellness) return;
        
        // é€‚ç”¨æ€§è¯„ä¼°
        const appContainer = document.getElementById('applicability-assessment-container');
        if (appContainer && wellness.applicabilityAssessment) {
          appContainer.innerHTML = wellness.applicabilityAssessment.map(item => `
            <div class="content-box">
              <p><strong>${escapeHtml(item.suitability)}</strong></p>
              <p><strong>åŸç†ï¼š</strong>${escapeHtml(item.principle)}</p>
            </div>
          `).join('');
        }
        
        // ç¦å¿Œç—‡
        const contraContainer = document.getElementById('contraindications-container');
        if (contraContainer && wellness.safetyAssessment?.contraindications) {
          contraContainer.innerHTML = wellness.safetyAssessment.contraindications
            .map(c => `<p>${escapeHtml(c)}</p>`).join('');
        }
        
        // æŠ½è¡€é¡¹ç›®
        const bloodContainer = document.getElementById('blood-draw-items-container');
        if (bloodContainer && wellness.supplementaryExams?.bloodDrawItems) {
          bloodContainer.innerHTML = wellness.supplementaryExams.bloodDrawItems
            .map(item => `<p>${escapeHtml(item)}</p>`).join('');
        }
        
        // å½±åƒå­¦æ£€æŸ¥
        const imgExamContainer = document.getElementById('imaging-exams-container');
        if (imgExamContainer && wellness.supplementaryExams?.imagingExams) {
          imgExamContainer.innerHTML = wellness.supplementaryExams.imagingExams
            .map(item => `<p>${escapeHtml(item)}</p>`).join('');
        }
      }
      
      /**
       * æ¸²æŸ“åº·å…»è®¡åˆ’ (healthPlan)
       */
      function renderHealthPlan(plan) {
        if (!plan) return;
        
        // ä¸»è¦å¥åº·é—®é¢˜
        const mainContainer = document.getElementById('main-issues-container');
        if (mainContainer && plan.mainIssues) {
          mainContainer.innerHTML = plan.mainIssues
            .map(issue => `<div class="content-box"><p>${escapeHtml(issue)}</p></div>`).join('');
        }
        
        // æ¬¡è¦å¥åº·é—®é¢˜
        const secContainer = document.getElementById('secondary-issues-container');
        if (secContainer && plan.secondaryIssues) {
          secContainer.innerHTML = plan.secondaryIssues
            .map(issue => `<div class="content-box"><p>${escapeHtml(issue)}</p></div>`).join('');
        }
        
        // åº·å…»è®¡åˆ’è¯¦æƒ…è¡¨æ ¼
        const planTbody = document.getElementById('plan-details-tbody');
        if (planTbody && plan.planDetails) {
          planTbody.innerHTML = plan.planDetails.map(detail => `
            <tr>
              <td>${escapeHtml(detail.planName || '')}</td>
              <td>${escapeHtml(detail.cellType || '')}</td>
              <td>${escapeHtml(detail.application || '')}</td>
              <td>${escapeHtml(detail.expectedEffect || '')}</td>
            </tr>
          `).join('');
        }
        
        // é¢„é˜²è®¡åˆ’
        const prevContainer = document.getElementById('preventive-plan-container');
        if (prevContainer && plan.preventivePlan) {
          prevContainer.innerHTML = plan.preventivePlan
            .map(p => `<p>${escapeHtml(p)}</p>`).join('');
        }
      }

      /**
       * (*** æ–°å¢ ***)
       * è®¾ç½®å½±åƒå¼¹çª— (Modal) çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
       */
      function setupModal() {
        const modal = document.getElementById('imageModal');
        // ç¡®ä¿ modal å­˜åœ¨
        if (!modal) {
            console.error("Modal HTML (imageModal) not found.");
            return;
        }
        
        const modalImg = document.getElementById('modalImage');
        const captionText = document.getElementById('caption');
        const span = document.getElementsByClassName('close-btn')[0];

        // 1. å…³é—­æŒ‰é’®
        if (span) {
            span.onclick = function() {
                modal.style.display = 'none';
            }
        }

        // 2. ç‚¹å‡» Modal å¤–éƒ¨å…³é—­
        modal.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // 3. ä¸ºæ‰€æœ‰ (æ–°æ¸²æŸ“çš„) gallery-image æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.gallery-image').forEach(img => {
            img.onclick = function() {
                modal.style.display = 'block';
                modalImg.src = this.src;
                // ä½¿ç”¨ data-description å±æ€§æ˜¾ç¤ºæ›´è¯¦ç»†çš„æè¿°
                captionText.innerHTML = this.dataset.description || this.alt;
            }
        });
        
        console.log("Modal äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®ã€‚");
      }
      
      /**
       * ä¸»å‡½æ•°ï¼šå¡«å……æ‰€æœ‰æ•°æ®
       * (*** æ­¤å‡½æ•°å·²æ›´æ–° ***)
       */
      function populateReport(reportData, imageData) {
        console.log('ğŸš€ å¼€å§‹å¡«å…… V3.4 æŠ¥å‘Šæ•°æ® (å¤–éƒ¨åŠ è½½)...');
        
        // 1. å¡«å……ç®€å•è·¯å¾„æ•°æ®
        fillSimplePaths(reportData);
        
        // 2. å¡«å……æ•°ç»„æ•°æ®
        renderSpecialistExams(reportData.specialistExams);
        renderLabResults(reportData.labResults);
        
        // (*** æ›´æ–° ***) ä¼ å…¥ reportData å’Œ imageData
        renderImagingResults(reportData.imagingResults, imageData ? imageData.category : {});
        
        renderExpertOpinions(reportData.expertOpinions);
        renderWellnessSafety(reportData.wellnessSafetyAssessment);
        renderHealthPlan(reportData.healthPlan);
        
        // (*** æ–°å¢ ***) åœ¨æ¸²æŸ“å®Œå½±åƒå»Šåï¼Œè®¾ç½® Modal ç‚¹å‡»äº‹ä»¶
        setupModal();

        console.log('âœ… æ•°æ®å¡«å……å®Œæˆ!');
      }

      /**
       * (*** æ–°å¢ ***)
       * åŠ è½½å¹¶æ¸²æŸ“æ‰€æœ‰æ•°æ®çš„ä¸»å…¥å£
       */
      async function loadAndRenderReport() {
        // å®šä¹‰è¦åŠ è½½çš„ JSON æ–‡ä»¶
        const reportDataFile = '2023.json'; // æŠ¥å‘Šæ•°æ® (æŒ‰æ‚¨è¦æ±‚å‘½å)
        const imageDataFile = 'image_data.json'; // å½±åƒæ•°æ®
        
        try {
            console.log(`æ­£åœ¨åŠ è½½ ${reportDataFile} å’Œ ${imageDataFile}...`);
            
            // å¹¶è¡ŒåŠ è½½ä¸¤ä¸ª JSON æ–‡ä»¶
            const [reportResponse, imageResponse] = await Promise.all([
                fetch(reportDataFile),
                fetch(imageDataFile)
            ]);

            if (!reportResponse.ok) {
                throw new Error(`æ— æ³•åŠ è½½ ${reportDataFile}: ${reportResponse.statusText}`);
            }
            if (!imageResponse.ok) {
                throw new Error(`æ— æ³•åŠ è½½ ${imageDataFile}: ${imageResponse.statusText}`);
            }

            // è§£æ JSON
            const reportData = await reportResponse.json();
            const imageData = await imageResponse.json();

            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!reportData) {
                throw new Error("æŠ¥å‘Šæ•°æ® (2025.json) ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯ã€‚");
            }
             if (!imageData) {
                throw new Error("å½±åƒæ•°æ® (image_data.json) ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯ã€‚");
            }

            // æˆåŠŸåŠ è½½æ‰€æœ‰æ•°æ®ï¼Œå¼€å§‹å¡«å……
            populateReport(reportData, imageData);

        } catch (error) {
            console.error('âŒ åŠ è½½æŠ¥å‘Šæ•°æ®æ—¶å‡ºé”™:', error);
            // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé”™è¯¯ï¼Œä»¥ä¾¿ç”¨æˆ·çŸ¥é“å‡ºäº†ä»€ä¹ˆé—®é¢˜
            document.body.innerHTML = `<div style="padding: 40px; text-align: center; font-family: sans-serif; color: red; font-size: 18px;">
                <h2>åŠ è½½æŠ¥å‘Šå¤±è´¥</h2>
                <p>æ— æ³•åŠ è½½å¿…è¦çš„JSONæ•°æ®æ–‡ä»¶ï¼ˆ${reportDataFile} æˆ– ${imageDataFile}ï¼‰ã€‚</p>
                <p>è¯·ç¡®ä¿æ–‡ä»¶å·²æ”¾ç½®åœ¨ä¸HTMLç›¸åŒçš„ç›®å½•ä¸­ï¼Œå¹¶ä¸”æ–‡ä»¶åæ­£ç¡®ã€‚</p>
                <p><strong>è¯¦ç»†é”™è¯¯:</strong> ${escapeHtml(error.message)}</p>
            </div>`;
        }
      }
      
      // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæ•°æ®åŠ è½½å’Œå¡«å……
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadAndRenderReport);
      } else {
        // DOM å·²åŠ è½½
        loadAndRenderReport();
      }
    </script>
    </body>
</html>