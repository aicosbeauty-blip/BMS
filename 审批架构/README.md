# 审批流程管理系统 - 文件拆分说明

## 📁 文件结构

```
project/
├── index.html                          # 主HTML文件（入口文件）
├── styles.css                          # 共享CSS样式文件
├── main-logic.js                       # 主应用逻辑
├── employee-permission-modal.html      # 员工权限编辑弹框HTML模板
├── employee-permission-modal.js        # 员工权限编辑弹框逻辑（独立模块）
├── 角色.json                           # 角色数据文件（需要自行提供）
├── 审批架构.json                       # 部门架构数据文件（需要自行提供）
└── 流程.json                           # 流程配置数据文件（可选）
```

## 📋 文件说明

### 1. **index.html** (主HTML文件)
- **作用**: 应用的入口文件，包含页面的基本结构
- **包含内容**:
  - 顶部导航栏
  - 左侧流程列表
  - 中间流程编辑画布
  - 右侧可用角色面板
  - 弹框容器（用于动态加载员工权限编辑弹框）
- **大小**: 约3KB

### 2. **styles.css** (样式文件)
- **作用**: 全局CSS样式定义
- **包含内容**:
  - 基础样式
  - 侧边栏动画
  - 员工标签样式
  - 公司卡片样式
  - 部门复选框样式
  - 滚动条样式
  - 角色节点样式
  - 拖放指示器样式
- **大小**: 约2KB

### 3. **main-logic.js** (主应用逻辑)
- **作用**: 处理主要的审批流程管理逻辑
- **包含功能**:
  - 数据加载（从JSON文件）
  - 流程列表渲染
  - 角色列表渲染
  - 工作流画布渲染
  - 拖拽功能实现
  - 节点增删改操作
  - 员工添加功能
  - 流程保存和导出
- **大小**: 约20KB

### 4. **employee-permission-modal.html** (员工权限弹框模板)
- **作用**: 员工权限编辑弹框的HTML结构
- **包含内容**:
  - 弹框头部（员工信息、统计数据）
  - 筛选栏（业务板块、公司、搜索）
  - 批量操作按钮
  - 公司和部门列表容器
  - 底部操作按钮
- **大小**: 约4KB
- **特点**: 独立的HTML模板，在运行时动态加载

### 5. **employee-permission-modal.js** (员工权限弹框逻辑)
- **作用**: 员工权限编辑的所有逻辑处理
- **采用模式**: 模块化设计（IIFE模式）
- **包含功能**:
  - 初始化模块
  - 打开/关闭弹框
  - 筛选器初始化和应用
  - 内容渲染（按公司分组）
  - 部门选择切换
  - 批量选择操作
  - 统计信息更新
  - 权限保存
- **公开API**:
  - `init()` - 初始化模块
  - `open()` - 打开弹框
  - `close()` - 关闭弹框
  - `save()` - 保存权限
  - `toggleDepartment()` - 切换部门
  - `toggleCompanyDepts()` - 切换公司所有部门
  - `selectAllVisible()` - 全选可见
  - `deselectAllVisible()` - 取消全选
- **大小**: 约12KB

## 🎯 拆分优势

### 1. **降低复杂度**
- 原文件约45KB，拆分后每个文件不超过20KB
- 职责清晰，便于理解和维护

### 2. **模块化设计**
- 员工权限编辑功能完全独立
- 可以单独开发、测试和复用
- 通过事件通信与主应用交互

### 3. **提高可维护性**
- 修改样式只需编辑CSS文件
- 修改弹框逻辑不影响主应用
- 便于多人协作开发

### 4. **按需加载**
- 员工权限弹框HTML在首次使用时才加载
- 减少初始页面加载时间

### 5. **代码复用**
- 员工权限编辑模块可以在其他项目中复用
- CSS样式可以被其他页面共享

## 🚀 使用方法

### 1. 部署文件
将所有文件放在同一目录下：
```
your-project/
├── index.html
├── styles.css
├── main-logic.js
├── employee-permission-modal.html
├── employee-permission-modal.js
├── 角色.json
├── 审批架构.json
└── 流程.json (可选)
```

### 2. 准备数据文件
确保提供以下JSON数据文件：
- **角色.json** (必需) - 包含角色和员工信息
- **审批架构.json** (可选) - 包含部门架构信息
- **流程.json** (可选) - 包含流程配置，不提供则使用默认流程

### 3. 启动应用
直接在浏览器中打开 `index.html` 文件即可

### 4. 使用员工权限编辑功能
点击任何员工标签上的齿轮图标，会弹出员工权限编辑面板

## 🔧 自定义和扩展

### 修改样式
编辑 `styles.css` 文件，可以自定义：
- 主题颜色
- 动画效果
- 布局样式
- 组件样式

### 扩展功能
1. **在主应用中添加功能**：编辑 `main-logic.js`
2. **扩展员工权限功能**：编辑 `employee-permission-modal.js`
3. **修改弹框样式**：编辑 `employee-permission-modal.html` 和 `styles.css`

### 事件监听
员工权限模块在保存时会触发自定义事件 `employeePermissionSaved`，可以在主应用中监听：

```javascript
document.addEventListener('employeePermissionSaved', function(e) {
    console.log('员工权限已保存:', e.detail);
    // 添加你的处理逻辑
});
```

## 📊 性能对比

| 指标 | 原始文件 | 拆分后 |
|------|---------|--------|
| 单文件大小 | ~45KB | 最大20KB |
| 代码行数 | ~1100行 | 最多600行/文件 |
| 维护难度 | 高 | 低 |
| 加载性能 | 一次加载全部 | 按需加载 |
| 可复用性 | 低 | 高 |

## 💡 最佳实践

1. **开发时**: 分别编辑各个文件，便于维护
2. **生产环境**: 可以考虑合并和压缩JS/CSS文件以提高性能
3. **版本控制**: 每个文件独立版本控制，便于追踪变更
4. **测试**: 可以单独测试员工权限模块，无需加载整个应用

## 🐛 调试提示

如果遇到问题，请检查：
1. 所有文件是否在同一目录下
2. 浏览器控制台是否有错误信息
3. JSON数据文件格式是否正确
4. 网络请求是否成功（检查Network标签）

## 📝 注意事项

- 本系统不包含模拟数据，需要提供真实的JSON数据文件
- 员工权限弹框HTML会在页面加载时动态加载
- 确保浏览器支持ES6语法（现代浏览器均支持）
- 建议使用本地服务器运行，避免跨域问题
